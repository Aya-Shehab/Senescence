<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bakery Admin Dashboard</title>
    <link rel="stylesheet" href="/css/admin.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/inventory.js"></script>
    <script src="/js/feedback.js"></script>
    <script src="/js/customOrders.js"></script>
    <script src="/js/orders.js"></script>
  </head>
  <body>
    <div class="sidebar">
      <h2>Bakery Admin</h2>
      <a onclick="showSection('modern-dashboard')"
        ><i class="fas fa-tachometer-alt"></i> Dashboard Overview</a
      >
      <a onclick="showSection('account')"
        ><i class="fas fa-user-circle"></i> Account Management</a
      >
      <a onclick="showSection('inventory')"
        ><i class="fas fa-boxes"></i> Inventory</a
      >
      <a onclick="showSection('orders')"
        ><i class="fas fa-shopping-cart"></i> Order Management</a
      >
      <a onclick="showSection('requests')"
        ><i class="fas fa-gift"></i> Special Requests</a
      >
      <a onclick="showSection('users')"
        ><i class="fas fa-users"></i> User Management</a
      >
      <a onclick="showSection('sales')"
        ><i class="fas fa-chart-line"></i> Sales Analysis</a
      >
      <a onclick="showSection('feedback')"
        ><i class="fas fa-comment-dots"></i> Feedback & Reviews</a
      >
    </div>

    <div class="main">
      <div class="navbar">
        <h1>Dashboard Overview</h1>
        <span>Welcome, Admin!</span>
      </div>

      <div id="modern-dashboard" class="section active-section">
        <div class="card-container">
          <div class="card highlight-card">
            <h3>ðŸŽ‰ Best seller of the month</h3>
            <p>Chocolate Cake</p>
            <h2 style="color: #4e73df">$48.9k</h2>
            <p>78% of target ðŸš€</p>
            <button class="btn view-btn">View sales</button>
          </div>

          <div class="card highlight-card">
            <h3>Sales</h3>
            <p>Total Sales</p>
            <h2 style="color: #4e73df">$4,679</h2>
            <p style="color: #28a745">+28.42%</p>
          </div>

          <div class="card highlight-card">
            <h3>Orders</h3>
            <p>Total Orders</p>
            <h2 style="color: #4e73df">1,245</h2>
            <p style="color: #28a745">+12.5%</p>
          </div>

          <div class="card highlight-card">
            <h3>Customer Orders</h3>
            <p>Order Value</p>
            <h2 style="color: #4e73df">$14,857</h2>
            <p style="color: #28a745">+9.8%</p>
          </div>

          <div class="card highlight-card">
            <h3>Profit</h3>
            <p>Net Profit</p>
            <h2 style="color: #4e73df">624k</h2>
            <div class="chart" id="chart">
              <div class="bar" style="height: 20%"></div>
              <div class="bar" style="height: 40%"></div>
              <div class="bar" style="height: 80%"></div>
              <div class="bar" style="height: 60%"></div>
              <div class="bar" style="height: 30%"></div>
            </div>
            <div class="labels">
              <span>Jan</span>
              <span>Apr</span>
              <span>Jul</span>
              <span>Oct</span>
            </div>
            <div class="tooltip" id="tooltip">series-1: 56</div>
          </div>
        </div>

        <div class="chart-container">
          <h3>Total Income (Yearly)</h3>
          <canvas id="incomeChart"></canvas>
        </div>
      </div>

      


      <div id="inventory" class="section">
        <div class="card-container">
          <div class="card highlight-card">
            <h3>Inventory Items</h3>
            <p id="totalItems">0</p>
          </div>
          <div class="card highlight-card">
            <button class="btn btn-primary" onclick="showAddProductForm()">
              <i class="bi bi-plus-circle"></i> Add New Product
            </button>
          </div>
        </div>

        <!-- Add/Edit Product Form -->
        <div id="productForm" class="chart-container" style="display: none;">
          <h3 id="formTitle">Add New Product</h3>
          <form id="inventoryForm" class="user-form">
            <input type="hidden" id="productId">
            <div class="row">
              <div class="col-md-6">
                <label for="name">Product Name:</label>
                <input type="text" id="name" name="name" required>

                <label for="category">Category:</label>
                <select id="category" name="category" required>
                  <option value="Cake">Cake</option>
                  <option value="Cookie">Cookie</option>
                  <option value="Croissant">Croissant</option>
                </select>

                <label for="imageUrl">Image URL:</label>
                <input type="text" id="imageUrl" name="imageUrl">

                <label for="pricePackWhole">Pack Price ($):</label>
                <input type="number" id="pricePackWhole" name="pricePackWhole" min="0" step="0.01" required>

                <label for="pricePiece">Piece Price ($):</label>
                <input type="number" id="pricePiece" name="pricePiece" min="0" step="0.01">
              </div>
              <div class="col-md-6">
                <label for="description">Description:</label>
                <textarea id="description" name="description"></textarea>

                <label for="ingredients">Ingredients (comma-separated):</label>
                <input type="text" id="ingredients" name="ingredients">

                <label for="inStock">In Stock:</label>
                <select id="inStock" name="inStock">
                  <option value="true">Yes</option>
                  <option value="false">No</option>
                </select>

                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" min="0" required>

                <label for="tags">Tags (comma-separated):</label>
                <input type="text" id="tags" name="tags">
              </div>
            </div>
            <div class="form-buttons">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" onclick="hideProductForm()">Cancel</button>
            </div>
          </form>
        </div>

        <div class="chart-container">
          <h3>Inventory Status</h3>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Product Name</th>
                  <th>Category</th>
                  <th>Photo</th>
                  <th>Pack Price ($)</th>
                  <th>Piece Price ($)</th>
                  <th>Description</th>
                  <th>Ingredients</th>
                  <th>In Stock</th>
                  <th>Quantity</th>
                  <th>Tags</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="inventory-tbody">
                <!-- Products will be loaded here dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>


      <div id="orders" class="section">
        <div class="card-container">
          <div class="card highlight-card">
            <h3>Order Management</h3>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p>Total Orders: <span id="totalOrders">0</span></p>
                <p>Pending Orders: <span id="pendingOrders">0</span></p>
              </div>
              <div>
                <button class="btn btn-primary" onclick="fetchOrders()">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="chart-container">
          <h3>Order Management Status</h3>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Order Number</th>
                  <th>Customer</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Address</th>
                  <th>Items</th>
                  <th>Total Price</th>
                  <th>Status</th>
                  <th>Payment</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="orders-tbody">
                <!-- Orders will be dynamically inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="requests" class="section">
        <div class="card-container">
          <div class="card highlight-card">
            <h3>Special Requests</h3>
            <p id="totalRequests">0</p>
            <button class="btn btn-primary" onclick="showAddRequestForm()">
              <i class="bi bi-plus-circle"></i> Add New Request
            </button>
          </div>
        </div>

        <!-- Add/Edit Request Form -->
        <div id="requestForm" class="chart-container" style="display: none;">
          <h3 id="formTitle">Add New Request</h3>
          <form id="customOrderForm" class="user-form">
            <input type="hidden" id="requestId">
            <div class="row">
              <div class="col-md-6">
                <label for="firstName">First Name:</label>
                <input type="text" id="firstName" name="firstName" required>

                <label for="lastName">Last Name:</label>
                <input type="text" id="lastName" name="lastName" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="phone">Phone:</label>
                <input type="text" id="phone" name="phone" required>

                <label for="address">Address:</label>
                <input type="text" id="address" name="address" required>
              </div>
              <div class="col-md-6">
                <label for="description">Description:</label>
                <textarea id="description" name="description" required></textarea>

                <label for="imageUrl">Image URL:</label>
                <input type="text" id="imageUrl" name="imageUrl">

                <label for="preferredDate">Preferred Date:</label>
                <input type="date" id="preferredDate" name="preferredDate">

                <label for="notes">Notes:</label>
                <textarea id="notes" name="notes"></textarea>

                <label for="status">Status:</label>
                <select id="status" name="status">
                  <option value="pending">Pending</option>
                  <option value="processing">Processing</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
            </div>
            <div class="form-buttons">
              <button type="submit" class="btn btn-primary">Save</button>
              <button type="button" class="btn btn-secondary" onclick="hideRequestForm()">Cancel</button>
            </div>
          </form>
        </div>

        <div class="chart-container">
          <h3>Special Requests Status</h3>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Address</th>
                  <th>Description</th>
                  <th>Photo</th>
                  <th>Preferred Date</th>
                  <th>Notes</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="requests-tbody">
                <!-- Requests will be loaded here dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="users" class="section">
        <div
          class="users-flex-container"
          style="display: flex; gap: 2rem; align-items: flex-start"
        >
          <div style="flex: 1">
            <input type="text" id="search" placeholder="Search users..." />
            <table class="user-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="users-tbody">
                <% users.forEach(user => { %>
                <tr>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td><%= user.phone || 'N/A' %></td>
                  <td><%= user.role %></td>
                  <td>
                    <span
                      class="status <%= user.isActive ? 'active' : 'inactive' %>"
                    >
                      <%= user.isActive ? 'Active' : 'Inactive' %>
                    </span>
                  </td>
                  <td>
                    <div class="dropdown">
                      <button
                        class="btn btn-secondary dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                      >
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                      <ul class="dropdown-menu">
                        <li>
                          <button
                            class="dropdown-item edit"
                            data-id="<%= user._id %>"
                          >
                            <i class="bi bi-pencil-square"></i> Edit
                          </button>
                        </li>
                        <li>
                          <button
                            class="dropdown-item toggle-status"
                            data-id="<%= user._id %>"
                          >
                            <i class="bi bi-toggle-on"></i> <%= user.isActive ?
                            'Deactivate' : 'Activate' %>
                          </button>
                        </li>
                        <li>
                          <button
                            class="dropdown-item delete text-danger delete-btn"
                            data-id="<%= user._id %>"
                          >
                            <i class="bi bi-trash"></i> Delete
                          </button>
                        </li>
                      </ul>
                    </div>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <div style="flex: 1">
            <h3>Add/Edit User</h3>
            <form class="user-form">
              <label for="name">Name:</label>
              <input type="text" id="name" name="name" required />

              <label for="email">Email:</label>
              <input type="email" id="email" name="email" required />

              <label for="phone">Phone:</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                pattern="^01[0125][0-9]{8}$"
              />

              <label for="role">Role:</label>
              <select id="role" name="role">
                <option value="customer">Customer</option>
                <option value="admin">Admin</option>
              </select>

              <label for="isActive">Status:</label>
              <select id="isActive" name="isActive">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>

              <button type="submit">Save</button>
            </form>
          </div>
        </div>
      </div>

      <div id="sales" class="section">
        <div class="card-container" style="display: flex; gap: 2rem">
          <div class="card highlight-card" style="flex: 1">
            <h3>Best Seller Product</h3>
            <p>Chocolate Cake</p>
            <h2 style="color: #4e73df">$12,500</h2>
            <p>320 sold this month</p>
          </div>
          <div class="card highlight-card" style="flex: 1">
            <h3>Top Customer</h3>
            <p>Jane Doe</p>
            <h2 style="color: #4e73df">$2,100</h2>
            <p>Most purchases this month</p>
          </div>
          <div class="card highlight-card" style="flex: 1">
            <h3>Highest Growth Category</h3>
            <p>Pastries</p>
            <h2 style="color: #4e73df">+18%</h2>
            <p>Compared to last month</p>
          </div>
        </div>
        <div class="chart-container">
          <h3>Monthly Sales Analysis</h3>
          <canvas id="salesChart"></canvas>
        </div>
      </div>

      <div id="feedback" class="section">
       
        <div class="chart-container">
          <h3>Customer Feedback List</h3>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Email</th>
                  <th>Message</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="feedback-tbody">
                <!-- Feedback rows will be dynamically inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>


      <div id="account" class="section">
        <div class="card-container">
          <div class="card highlight-card">
            <h3>ðŸ‘¤ My Account</h3>
            <h2 style="color: #4e73df">Admin Profile</h2>
            <p>Account Status: Active</p>
            <button class="btn view-btn">Edit Profile</button>
          </div>

          <div class="card highlight-card">
            <div class="title">Last Login</div>
            <div class="amount">Today</div>
            <div class="change">9:30 AM</div>
          </div>
        </div>

        <div class="profile-container" style="display: flex; gap: 2rem">
          <div class="chart-container" style="flex: 1">
            <h3>Profile Information</h3>
            <form class="user-form" id="accountForm">
              <label for="adminName">Full Name:</label>
              <input type="text" id="adminName" value="John Admin" required />

              <label for="adminEmail">Email:</label>
              <input
                type="email"
                id="adminEmail"
                value="admin@bakery.com"
                required
              />

              <label for="adminPhone">Phone:</label>
              <input type="tel" id="adminPhone" value="+1 (555) 123-4567" />

              <label for="adminRole">Role:</label>
              <input
                type="text"
                id="adminRole"
                value="Store Manager"
                readonly
              />

              <button type="submit">Save Changes</button>
            </form>
          </div>
          <div class="chart-container" style="flex: 1">
            <h3>Change Password</h3>
            <form class="user-form" id="passwordForm">
              <label for="currentPass">Current Password:</label>
              <input type="password" id="currentPass" required />

              <label for="newPass">New Password:</label>
              <input type="password" id="newPass" minlength="8" />

              <label for="confirmPass">Confirm Password:</label>
              <input type="password" id="confirmPass" minlength="8" />

              <button type="submit">Update Password</button>
            </form>
          </div>
        </div>
      </div>

      <div id="products" class="section">
        <div class="card-container">
          <div class="card highlight-card"><h3>Product Management</h3></div>
        </div>
        <div class="chart-container">
          <h3>All Products</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Price (Whole)</th>
                  <th>Price (Piece)</th>
                  <th>Stock</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="products-tbody">
                <!-- Product rows will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", async (e) => {
            e.preventDefault();
            const userId = btn.getAttribute("data-id");

            console.log(userId);

            if (confirm("Are you sure you want to delete this user?")) {
              try {
                const response = await fetch(`/api/v1/users/${userId}`, {
                  method: "DELETE",
                  headers: {
                    "Content-Type": "application/json",
                  },
                });

                if (response.ok) {
                  btn.closest("tr").remove();
                  alert("User deleted successfully");
                } else {
                  alert("Failed to delete user");
                }
              } catch (error) {
                console.error("Error deleting user:", error);
                alert("Error deleting user");
              }
            }
          });
        });
      });
    </script>
  </body>
</html>


